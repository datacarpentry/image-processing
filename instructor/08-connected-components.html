<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Image Processing with Python: Connected Component Analysis</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/dc/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/dc/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/dc/favicon-16x16.png"><link rel="manifest" href="../favicons/dc/site.webmanifest"><link rel="mask-icon" href="../favicons/dc/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav data"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dc-logo" alt="Data Carpentry" src="../assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../08-connected-components.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="../assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Image Processing with Python
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Image Processing with Python
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="edge-detection.html">Extra Episode: Edge Detection</a></li><li><a class="dropdown-item" href="prereqs.html">Prerequisites</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Image Processing with Python
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 74%" class="percentage">
    74%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 74%" aria-valuenow="74" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../08-connected-components.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-image-basics.html">2. Image Basics</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-skimage-images.html">3. Working with scikit-image</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-drawing.html">4. Drawing and Bitwise Operations</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-creating-histograms.html">5. Creating Histograms</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-blurring.html">6. Blurring Images</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-thresholding.html">7. Thresholding</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        8. Connected Component Analysis
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#objects">Objects</a></li>
<li><a href="#pixel-neighborhoods">Pixel Neighborhoods</a></li>
<li><a href="#connected-component-analysis">Connected Component Analysis</a></li>
<li><a href="#morphometrics---describe-object-features-with-numbers">Morphometrics - Describe object features with numbers</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-challenges.html">9. Capstone Challenge</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="edge-detection.html">Extra Episode: Edge Detection</a></li><li><a class="dropdown-item" href="prereqs.html">Prerequisites</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/07-thresholding.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/09-challenges.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/07-thresholding.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Thresholding
        </a>
        <a class="chapter-link float-end" href="../instructor/09-challenges.html" rel="next">
          Next: Capstone Challenge...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Connected Component Analysis</h1>
        <p>Last updated on 2024-11-13 |

        <a href="https://github.com/datacarpentry/image-processing/edit/main/episodes/08-connected-components.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 125 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How to extract separate objects from an image and describe these
objects quantitatively.</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand the term object in the context of images.</li>
<li>Learn about pixel connectivity.</li>
<li>Learn how Connected Component Analysis (CCA) works.</li>
<li>Use CCA to produce an image that highlights every object in a
different colour.</li>
<li>Characterise each object with numbers that describe its
appearance.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="objects">Objects<a class="anchor" aria-label="anchor" href="#objects"></a></h2>
<hr class="half-width"><p>In <a href="07-thresholding.html">the <em>Thresholding</em>
episode</a> we have covered dividing an image into foreground and
background pixels. In the shapes example image, we considered the
coloured shapes as foreground <em>objects</em> on a white
background.</p>
<figure><img src="../data/shapes-01.jpg" class="image-with-shadow figure mx-auto d-block" alt="Original shapes image"></figure><p>In thresholding we went from the original image to this version:</p>
<figure><img src="../fig/shapes-01-mask.png" alt="Mask created by thresholding" class="figure mx-auto d-block"></figure><p>Here, we created a mask that only highlights the parts of the image
that we find interesting, the <em>objects</em>. All objects have pixel
value of <code>True</code> while the background pixels are
<code>False</code>.</p>
<p>By looking at the mask image, one can count the objects that are
present in the image (7). But how did we actually do that, how did we
decide which lump of pixels constitutes a single object?</p>
<!-- TODO: Group exercise: given sheep of paper with grids of 0's and
1's, how to identify which pixels belong to an object, find a rule for
each pixel to determine in which object it is -->
</section><section><h2 class="section-heading" id="pixel-neighborhoods">Pixel Neighborhoods<a class="anchor" aria-label="anchor" href="#pixel-neighborhoods"></a></h2>
<hr class="half-width"><p>In order to decide which pixels belong to the same object, one can
exploit their neighborhood: pixels that are directly next to each other
and belong to the foreground class can be considered to belong to the
same object.</p>
<p>Let’s discuss the concept of pixel neighborhoods in more detail.
Consider the following mask “image” with 8 rows, and 8 columns. For the
purpose of illustration, the digit <code>0</code> is used to represent
background pixels, and the letter <code>X</code> is used to represent
object pixels foreground).</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0 0 0 0 0 0 0 0
0 X X 0 0 0 0 0
0 X X 0 0 0 0 0
0 0 0 X X X 0 0
0 0 0 X X X X 0
0 0 0 0 0 0 0 0</code></pre>
</div>
<p>The pixels are organised in a rectangular grid. In order to
understand pixel neighborhoods we will introduce the concept of “jumps”
between pixels. The jumps follow two rules: First rule is that one jump
is only allowed along the column, or the row. Diagonal jumps are not
allowed. So, from a centre pixel, denoted with <code>o</code>, only the
pixels indicated with a <code>1</code> are reachable:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>- 1 -
1 o 1
- 1 -</code></pre>
</div>
<p>The pixels on the diagonal (from <code>o</code>) are not reachable
with a single jump, which is denoted by the <code>-</code>. The pixels
reachable with a single jump form the <strong>1-jump</strong>
neighborhood.</p>
<p>The second rule states that in a sequence of jumps, one may only jump
in row and column direction once -&gt; they have to be
<em>orthogonal</em>. An example of a sequence of orthogonal jumps is
shown below. Starting from <code>o</code> the first jump goes along the
row to the right. The second jump then goes along the column direction
up. After this, the sequence cannot be continued as a jump has already
been made in both row and column direction.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>- - 2
- o 1
- - -</code></pre>
</div>
<p>All pixels reachable with one, or two jumps form the
<strong>2-jump</strong> neighborhood. The grid below illustrates the
pixels reachable from the centre pixel <code>o</code> with a single
jump, highlighted with a <code>1</code>, and the pixels reachable with 2
jumps with a <code>2</code>.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>2 1 2
1 o 1
2 1 2</code></pre>
</div>
<p>We want to revisit our example image mask from above and apply the
two different neighborhood rules. With a single jump connectivity for
each pixel, we get two resulting objects, highlighted in the image with
<code>A</code>’s and <code>B</code>’s.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0 0 0 0 0 0 0 0
0 A A 0 0 0 0 0
0 A A 0 0 0 0 0
0 0 0 B B B 0 0
0 0 0 B B B B 0
0 0 0 0 0 0 0 0</code></pre>
</div>
<p>In the 1-jump version, only pixels that have direct neighbors along
rows or columns are considered connected. Diagonal connections are not
included in the 1-jump neighborhood. With two jumps, however, we only
get a single object <code>A</code> because pixels are also considered
connected along the diagonals.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0 0 0 0 0 0 0 0
0 A A 0 0 0 0 0
0 A A 0 0 0 0 0
0 0 0 A A A 0 0
0 0 0 A A A A 0
0 0 0 0 0 0 0 0</code></pre>
</div>
<div id="object-counting-optional-not-included-in-timing" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="object-counting-optional-not-included-in-timing" class="callout-inner">
<h3 class="callout-title">Object counting (optional, not included in timing)</h3>
<div class="callout-content">
<p>How many objects with 1 orthogonal jump, how many with 2 orthogonal
jumps?</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0 0 0 0 0 0 0 0
0 X 0 0 0 X X 0
0 0 X 0 0 0 0 0
0 X 0 X X X 0 0
0 X 0 X X 0 0 0
0 0 0 0 0 0 0 0</code></pre>
</div>
<p>1 jump</p>
<ol style="list-style-type: lower-alpha"><li>1</li>
<li>5</li>
<li>2</li>
</ol></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol start="2" style="list-style-type: lower-alpha"><li>5</li>
</ol></div>
</div>
</div>
</div>
<div id="object-counting-optional-not-included-in-timing" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="object-counting-optional-not-included-in-timing" class="callout-inner">
<h3 class="callout-title">Object counting (optional, not included in
timing)<em> (continued)</em>
</h3>
<div class="callout-content">
<p>2 jumps</p>
<ol style="list-style-type: lower-alpha"><li>2</li>
<li>3</li>
<li>5</li>
</ol></div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha"><li>2</li>
</ol></div>
</div>
</div>
</div>
<div id="jumps-and-neighborhoods" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="jumps-and-neighborhoods" class="callout-inner">
<h3 class="callout-title">Jumps and neighborhoods</h3>
<div class="callout-content">
<p>We have just introduced how you can reach different neighboring
pixels by performing one or more orthogonal jumps. We have used the
terms 1-jump and 2-jump neighborhood. There is also a different way of
referring to these neighborhoods: the 4- and 8-neighborhood. With a
single jump you can reach four pixels from a given starting pixel.
Hence, the 1-jump neighborhood corresponds to the 4-neighborhood. When
two orthogonal jumps are allowed, eight pixels can be reached, so the
2-jump neighborhood corresponds to the 8-neighborhood.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="connected-component-analysis">Connected Component Analysis<a class="anchor" aria-label="anchor" href="#connected-component-analysis"></a></h2>
<hr class="half-width"><p>In order to find the objects in an image, we want to employ an
operation that is called Connected Component Analysis (CCA). This
operation takes a binary image as an input. Usually, the
<code>False</code> value in this image is associated with background
pixels, and the <code>True</code> value indicates foreground, or object
pixels. Such an image can be produced, e.g., with thresholding. Given a
thresholded image, the connected component analysis produces a new
<em>labeled</em> image with integer pixel values. Pixels with the same
value, belong to the same object. scikit-image provides connected
component analysis in the function <code>ski.measure.label()</code>. Let
us add this function to the already familiar steps of thresholding an
image.</p>
<p>First, import the packages needed for this episode:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">import</span> imageio.v3 <span class="im">as</span> iio</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="im">import</span> ipympl</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="im">import</span> skimage <span class="im">as</span> ski</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="op">%</span>matplotlib widget</span></code></pre>
</div>
<p>In this episode, we will use the <code>ski.measure.label</code>
function to perform the CCA.</p>
<p>Next, we define a reusable Python function
<code>connected_components</code>:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">def</span> connected_components(filename, sigma<span class="op">=</span><span class="fl">1.0</span>, t<span class="op">=</span><span class="fl">0.5</span>, connectivity<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="co"># load the image</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    image <span class="op">=</span> iio.imread(filename)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="co"># convert the image to grayscale</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    gray_image <span class="op">=</span> ski.color.rgb2gray(image)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="co"># denoise the image with a Gaussian filter</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    blurred_image <span class="op">=</span> ski.filters.gaussian(gray_image, sigma<span class="op">=</span>sigma)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    <span class="co"># mask the image according to threshold</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    binary_mask <span class="op">=</span> blurred_image <span class="op">&lt;</span> t</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    <span class="co"># perform connected component analysis</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    labeled_image, count <span class="op">=</span> ski.measure.label(binary_mask,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>                                                 connectivity<span class="op">=</span>connectivity, return_num<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    <span class="cf">return</span> labeled_image, count</span></code></pre>
</div>
<p>The first four lines of code are familiar from <a href="07-thresholding.html">the <em>Thresholding</em> episode</a>.</p>
<!-- Note: shapes image: with sigma=2.0, threshold=0.9 -> 11 objects; with sigma=5 -> 8 objects -->
<p>Then we call the <code>ski.measure.label</code> function. This
function has one positional argument where we pass the
<code>binary_mask</code>, i.e., the binary image to work on. With the
optional argument <code>connectivity</code>, we specify the neighborhood
in units of orthogonal jumps. For example, by setting
<code>connectivity=2</code> we will consider the 2-jump neighborhood
introduced above. The function returns a <code>labeled_image</code>
where each pixel has a unique value corresponding to the object it
belongs to. In addition, we pass the optional parameter
<code>return_num=True</code> to return the maximum label index as
<code>count</code>.</p>
<div id="optional-parameters-and-return-values" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="optional-parameters-and-return-values" class="callout-inner">
<h3 class="callout-title">Optional parameters and return values</h3>
<div class="callout-content">
<p>The optional parameter <code>return_num</code> changes the data type
that is returned by the function <code>ski.measure.label</code>. The
number of labels is only returned if <code>return_num</code> is
<em>True</em>. Otherwise, the function only returns the labeled image.
This means that we have to pay attention when assigning the return value
to a variable. If we omit the optional parameter <code>return_num</code>
or pass <code>return_num=False</code>, we can call the function as</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>labeled_image <span class="op">=</span> ski.measure.label(binary_mask)</span></code></pre>
</div>
<p>If we pass <code>return_num=True</code>, the function returns a tuple
and we can assign it as</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>labeled_image, count <span class="op">=</span> ski.measure.label(binary_mask, return_num<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>If we used the same assignment as in the first case, the variable
<code>labeled_image</code> would become a tuple, in which
<code>labeled_image[0]</code> is the image and
<code>labeled_image[1]</code> is the number of labels. This could cause
confusion if we assume that <code>labeled_image</code> only contains the
image and pass it to other functions. If you get an
<code>AttributeError: 'tuple' object has no attribute 'shape'</code> or
similar, check if you have assigned the return values consistently with
the optional parameters.</p>
</div>
</div>
</div>
<p>We can call the above function <code>connected_components</code> and
display the labeled image like so:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>labeled_image, count <span class="op">=</span> connected_components(filename<span class="op">=</span><span class="st">"data/shapes-01.jpg"</span>, sigma<span class="op">=</span><span class="fl">2.0</span>, t<span class="op">=</span><span class="fl">0.9</span>, connectivity<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>ax.imshow(labeled_image)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>ax.set_axis_off()<span class="op">;</span></span></code></pre>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Do you see an empty image? </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>If you are using an older version of Matplotlib you might get a
warning
<code>UserWarning: Low image data range; displaying image with stretched contrast.</code>
or just see a visually empty image.</p>
<p>What went wrong? When you hover over the image, the pixel values are
shown as numbers in the lower corner of the viewer. You can see that
some pixels have values different from <code>0</code>, so they are not
actually all the same value. Let’s find out more by examining
<code>labeled_image</code>. Properties that might be interesting in this
context are <code>dtype</code>, the minimum and maximum value. We can
print them with the following lines:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"dtype:"</span>, labeled_image.dtype)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"min:"</span>, np.<span class="bu">min</span>(labeled_image))</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"max:"</span>, np.<span class="bu">max</span>(labeled_image))</span></code></pre>
</div>
<p>Examining the output can give us a clue why the image appears
empty.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">dtype</span><span class="op">:</span> <span class="va">int32</span></span>
<span><span class="va">min</span><span class="op">:</span> <span class="fl">0</span></span>
<span><span class="va">max</span><span class="op">:</span> <span class="fl">11</span></span></code></pre>
</div>
<p>The <code>dtype</code> of <code>labeled_image</code> is
<code>int32</code>. This means that values in this image range from
<code>-2 ** 31</code> to <code>2 ** 31 - 1</code>. Those are really big
numbers. From this available space we only use the range from
<code>0</code> to <code>11</code>. When showing this image in the
viewer, it may squeeze the complete range into 256 gray values.
Therefore, the range of our numbers does not produce any visible
variation. One way to rectify this is to explicitly specify the data
range we want the colormap to cover:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>ax.imshow(labeled_image, vmin<span class="op">=</span>np.<span class="bu">min</span>(labeled_image), vmax<span class="op">=</span>np.<span class="bu">max</span>(labeled_image))</span></code></pre>
</div>
<p>Note this is the default behaviour for newer versions of
<code>matplotlib.pyplot.imshow</code>. Alternatively we could convert
the image to RGB and then display it.</p>
</div>
</div>
</div>
</div>
<div id="suppressing-outputs-in-jupyter-notebooks" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="suppressing-outputs-in-jupyter-notebooks" class="callout-inner">
<h3 class="callout-title">Suppressing outputs in Jupyter Notebooks</h3>
<div class="callout-content">
<p>We just used <code>ax.set_axis_off();</code> to hide the axis from
the image for a visually cleaner figure. The semicolon is added to
supress the output(s) of the statement, in this <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.axis.html" class="external-link">case</a>
the axis limits. This is specific to Jupyter Notebooks.</p>
</div>
</div>
</div>
<p>We can use the function <code>ski.color.label2rgb()</code> to convert
the 32-bit grayscale labeled image to standard RGB colour (recall that
we already used the <code>ski.color.rgb2gray()</code> function to
convert to grayscale). With <code>ski.color.label2rgb()</code>, all
objects are coloured according to a list of colours that can be
customised. We can use the following commands to convert and show the
image:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># convert the label image to color image</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>colored_label_image <span class="op">=</span> ski.color.label2rgb(labeled_image, bg_label<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>ax.imshow(colored_label_image)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>ax.set_axis_off()<span class="op">;</span></span></code></pre>
</div>
<figure><img src="../fig/shapes-01-labeled.png" alt="Labeled objects" class="figure mx-auto d-block"></figure><div id="how-many-objects-are-in-that-image-15-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="how-many-objects-are-in-that-image-15-min" class="callout-inner">
<h3 class="callout-title">How many objects are in that image (15 min)</h3>
<div class="callout-content">
<p>Now, it is your turn to practice. Using the function
<code>connected_components</code>, find two ways of printing out the
number of objects found in the image.</p>
<p>What number of objects would you expect to get?</p>
<p>How does changing the <code>sigma</code> and <code>threshold</code>
values influence the result?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>As you might have guessed, the return value <code>count</code>
already contains the number of objects found in the image. So it can
simply be printed with</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Found"</span>, count, <span class="st">"objects in the image."</span>)</span></code></pre>
</div>
<p>But there is also a way to obtain the number of found objects from
the labeled image itself. Recall that all pixels that belong to a single
object are assigned the same integer value. The connected component
algorithm produces consecutive numbers. The background gets the value
<code>0</code>, the first object gets the value <code>1</code>, the
second object the value <code>2</code>, and so on. This means that by
finding the object with the maximum value, we also know how many objects
there are in the image. We can thus use the <code>np.max</code> function
from NumPy to find the maximum value that equals the number of found
objects:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>num_objects <span class="op">=</span> np.<span class="bu">max</span>(labeled_image)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Found"</span>, num_objects, <span class="st">"objects in the image."</span>)</span></code></pre>
</div>
<p>Invoking the function with <code>sigma=2.0</code>, and
<code>threshold=0.9</code>, both methods will print</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Found 11 objects in the image.</code></pre>
</div>
<p>Lowering the threshold will result in fewer objects. The higher the
threshold is set, the more objects are found. More and more background
noise gets picked up as objects. Larger sigmas produce binary masks with
less noise and hence a smaller number of objects. Setting sigma too high
bears the danger of merging objects.</p>
</div>
</div>
</div>
</div>
<p>You might wonder why the connected component analysis with
<code>sigma=2.0</code>, and <code>threshold=0.9</code> finds 11 objects,
whereas we would expect only 7 objects. Where are the four additional
objects? With a bit of detective work, we can spot some small objects in
the image, for example, near the left border.</p>
<figure><img src="../fig/shapes-01-cca-detail.png" alt="shapes-01.jpg mask detail" class="figure mx-auto d-block"></figure><p>For us it is clear that these small spots are artifacts and not
objects we are interested in. But how can we tell the computer? One way
to calibrate the algorithm is to adjust the parameters for blurring
(<code>sigma</code>) and thresholding (<code>t</code>), but you may have
noticed during the above exercise that it is quite hard to find a
combination that produces the right output number. In some cases,
background noise gets picked up as an object. And with other parameters,
some of the foreground objects get broken up or disappear completely.
Therefore, we need other criteria to describe desired properties of the
objects that are found.</p>
</section><section><h2 class="section-heading" id="morphometrics---describe-object-features-with-numbers">Morphometrics - Describe object features with numbers<a class="anchor" aria-label="anchor" href="#morphometrics---describe-object-features-with-numbers"></a></h2>
<hr class="half-width"><p>Morphometrics is concerned with the quantitative analysis of objects
and considers properties such as size and shape. For the example of the
images with the shapes, our intuition tells us that the objects should
be of a certain size or area. So we could use a minimum area as a
criterion for when an object should be detected. To apply such a
criterion, we need a way to calculate the area of objects found by
connected components. Recall how we determined the root mass in <a href="07-thresholding.html">the <em>Thresholding</em> episode</a> by
counting the pixels in the binary mask. But here we want to calculate
the area of several objects in the labeled image. The scikit-image
library provides the function <code>ski.measure.regionprops</code> to
measure the properties of labeled regions. It returns a list of
<code>RegionProperties</code> that describe each connected region in the
images. The properties can be accessed using the attributes of the
<code>RegionProperties</code> data type. Here we will use the properties
<code>"area"</code> and <code>"label"</code>. You can explore the
scikit-image documentation to learn about other properties
available.</p>
<p>We can get a list of areas of the labeled objects as follows:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># compute object features and extract object areas</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>object_features <span class="op">=</span> ski.measure.regionprops(labeled_image)</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>object_areas <span class="op">=</span> [objf[<span class="st">"area"</span>] <span class="cf">for</span> objf <span class="kw">in</span> object_features]</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>object_areas</span></code></pre>
</div>
<p>This will produce the output</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[318542, 1, 523204, 496613, 517331, 143, 256215, 1, 68, 338784, 265755]</code></pre>
</div>
<div id="plot-a-histogram-of-the-object-area-distribution-10-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="plot-a-histogram-of-the-object-area-distribution-10-min" class="callout-inner">
<h3 class="callout-title">Plot a histogram of the object area distribution (10 min)</h3>
<div class="callout-content">
<p>Similar to how we determined a “good” threshold in <a href="07-thresholding.html">the <em>Thresholding</em> episode</a>, it is
often helpful to inspect the histogram of an object property. For
example, we want to look at the distribution of the object areas.</p>
<ol style="list-style-type: decimal"><li>Create and examine a <a href="05-creating-histograms.html">histogram</a> of the object areas
obtained with <code>ski.measure.regionprops</code>.</li>
<li>What does the histogram tell you about the objects?</li>
</ol></div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>The histogram can be plotted with</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>ax.hist(object_areas)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Area (pixels)"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Number of objects"</span>)<span class="op">;</span></span></code></pre>
</div>
<figure><img src="../fig/shapes-01-areas-histogram.png" alt="Histogram of object areas" class="figure mx-auto d-block"></figure><p>The histogram shows the number of objects (vertical axis) whose area
is within a certain range (horizontal axis). The height of the bars in
the histogram indicates the prevalence of objects with a certain area.
The whole histogram tells us about the distribution of object sizes in
the image. It is often possible to identify gaps between groups of bars
(or peaks if we draw the histogram as a continuous curve) that tell us
about certain groups in the image.</p>
<p>In this example, we can see that there are four small objects that
contain less than 50000 pixels. Then there is a group of four (1+1+2)
objects in the range between 200000 and 400000, and three objects with a
size around 500000. For our object count, we might want to disregard the
small objects as artifacts, i.e, we want to ignore the leftmost bar of
the histogram. We could use a threshold of 50000 as the minimum area to
count. In fact, the <code>object_areas</code> list already tells us that
there are fewer than 200 pixels in these objects. Therefore, it is
reasonable to require a minimum area of at least 200 pixels for a
detected object. In practice, finding the “right” threshold can be
tricky and usually involves an educated guess based on domain
knowledge.</p>
</div>
</div>
</div>
</div>
<div id="filter-objects-by-area-10-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="filter-objects-by-area-10-min" class="callout-inner">
<h3 class="callout-title">Filter objects by area (10 min)</h3>
<div class="callout-content">
<p>Now we would like to use a minimum area criterion to obtain a more
accurate count of the objects in the image.</p>
<ol style="list-style-type: decimal"><li>Find a way to calculate the number of objects by only counting
objects above a certain area.</li>
</ol></div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>One way to count only objects above a certain area is to first create
a list of those objects, and then take the length of that list as the
object count. This can be done as follows:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>min_area <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>large_objects <span class="op">=</span> []</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="cf">for</span> objf <span class="kw">in</span> object_features:</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>    <span class="cf">if</span> objf[<span class="st">"area"</span>] <span class="op">&gt;</span> min_area:</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>        large_objects.append(objf[<span class="st">"label"</span>])</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Found"</span>, <span class="bu">len</span>(large_objects), <span class="st">"objects!"</span>)</span></code></pre>
</div>
<p>Another option is to use NumPy arrays to create the list of large
objects. We first create an array <code>object_areas</code> containing
the object areas, and an array <code>object_labels</code> containing the
object labels. The labels of the objects are also returned by
<code>ski.measure.regionprops</code>. We have already seen that we can
create boolean arrays using comparison operators. Here we can use
<code>object_areas &gt; min_area</code> to produce an array that has the
same dimension as <code>object_labels</code>. It can then be used to
select the labels of objects whose area is greater than
<code>min_area</code> by indexing:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>object_areas <span class="op">=</span> np.array([objf[<span class="st">"area"</span>] <span class="cf">for</span> objf <span class="kw">in</span> object_features])</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>object_labels <span class="op">=</span> np.array([objf[<span class="st">"label"</span>] <span class="cf">for</span> objf <span class="kw">in</span> object_features])</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>large_objects <span class="op">=</span> object_labels[object_areas <span class="op">&gt;</span> min_area]</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Found"</span>, <span class="bu">len</span>(large_objects), <span class="st">"objects!"</span>)</span></code></pre>
</div>
<p>The advantage of using NumPy arrays is that <code>for</code> loops
and <code>if</code> statements in Python can be slow, and in practice
the first approach may not be feasible if the image contains a large
number of objects. In that case, NumPy array functions turn out to be
very useful because they are much faster.</p>
<p>In this example, we can also use the <code>np.count_nonzero</code>
function that we have seen earlier together with the <code>&gt;</code>
operator to count the objects whose area is above
<code>min_area</code>.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>n <span class="op">=</span> np.count_nonzero(object_areas <span class="op">&gt;</span> min_area)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Found"</span>, n, <span class="st">"objects!"</span>)</span></code></pre>
</div>
<p>For all three alternatives, the output is the same and gives the
expected count of 7 objects.</p>
</div>
</div>
</div>
</div>
<div id="using-functions-from-numpy-and-other-python-packages" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="using-functions-from-numpy-and-other-python-packages" class="callout-inner">
<h3 class="callout-title">Using functions from NumPy and other Python packages</h3>
<div class="callout-content">
<p>Functions from Python packages such as NumPy are often more efficient
and require less code to write. It is a good idea to browse the
reference pages of <code>numpy</code> and <code>skimage</code> to look
for an availabe function that can solve a given task.</p>
</div>
</div>
</div>
<div id="remove-small-objects-20-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="remove-small-objects-20-min" class="callout-inner">
<h3 class="callout-title">Remove small objects (20 min)</h3>
<div class="callout-content">
<p>We might also want to exclude (mask) the small objects when plotting
the labeled image.</p>
<ol start="2" style="list-style-type: decimal"><li>Enhance the <code>connected_components</code> function such that it
automatically removes objects that are below a certain area that is
passed to the function as an optional parameter.</li>
</ol></div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>To remove the small objects from the labeled image, we change the
value of all pixels that belong to the small objects to the background
label 0. One way to do this is to loop over all objects and set the
pixels that match the label of the object to 0.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="cf">for</span> object_id, objf <span class="kw">in</span> <span class="bu">enumerate</span>(object_features, start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>    <span class="cf">if</span> objf[<span class="st">"area"</span>] <span class="op">&lt;</span> min_area:</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>        labeled_image[labeled_image <span class="op">==</span> objf[<span class="st">"label"</span>]] <span class="op">=</span> <span class="dv">0</span></span></code></pre>
</div>
<p>Here NumPy functions can also be used to eliminate <code>for</code>
loops and <code>if</code> statements. Like above, we can create an array
of the small object labels with the comparison
<code>object_areas &lt; min_area</code>. We can use another NumPy
function, <code>np.isin</code>, to set the pixels of all small objects
to 0. <code>np.isin</code> takes two arrays and returns a boolean array
with values <code>True</code> if the entry of the first array is found
in the second array, and <code>False</code> otherwise. This array can
then be used to index the <code>labeled_image</code> and set the entries
that belong to small objects to <code>0</code>.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>object_areas <span class="op">=</span> np.array([objf[<span class="st">"area"</span>] <span class="cf">for</span> objf <span class="kw">in</span> object_features])</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>object_labels <span class="op">=</span> np.array([objf[<span class="st">"label"</span>] <span class="cf">for</span> objf <span class="kw">in</span> object_features])</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>small_objects <span class="op">=</span> object_labels[object_areas <span class="op">&lt;</span> min_area]</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>labeled_image[np.isin(labeled_image, small_objects)] <span class="op">=</span> <span class="dv">0</span></span></code></pre>
</div>
<p>An even more elegant way to remove small objects from the image is to
leverage the <code>ski.morphology</code> module. It provides a function
<code>ski.morphology.remove_small_objects</code> that does exactly what
we are looking for. It can be applied to a binary image and returns a
mask in which all objects smaller than <code>min_area</code> are
excluded, i.e, their pixel values are set to <code>False</code>. We can
then apply <code>ski.measure.label</code> to the masked image:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>object_mask <span class="op">=</span> ski.morphology.remove_small_objects(binary_mask, min_size<span class="op">=</span>min_area)</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>labeled_image, n <span class="op">=</span> ski.measure.label(object_mask,</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>                                         connectivity<span class="op">=</span>connectivity, return_num<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>Using the scikit-image features, we can implement the
<code>enhanced_connected_component</code> as follows:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="kw">def</span> enhanced_connected_components(filename, sigma<span class="op">=</span><span class="fl">1.0</span>, t<span class="op">=</span><span class="fl">0.5</span>, connectivity<span class="op">=</span><span class="dv">2</span>, min_area<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>    image <span class="op">=</span> iio.imread(filename)</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    gray_image <span class="op">=</span> ski.color.rgb2gray(image)</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>    blurred_image <span class="op">=</span> ski.filters.gaussian(gray_image, sigma<span class="op">=</span>sigma)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>    binary_mask <span class="op">=</span> blurred_image <span class="op">&lt;</span> t</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>    object_mask <span class="op">=</span> ski.morphology.remove_small_objects(binary_mask, min_size<span class="op">=</span>min_area)</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>    labeled_image, count <span class="op">=</span> ski.measure.label(object_mask,</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>                                                 connectivity<span class="op">=</span>connectivity, return_num<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>    <span class="cf">return</span> labeled_image, count</span></code></pre>
</div>
<p>We can now call the function with a chosen <code>min_area</code> and
display the resulting labeled image:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>labeled_image, count <span class="op">=</span> enhanced_connected_components(filename<span class="op">=</span><span class="st">"data/shapes-01.jpg"</span>, sigma<span class="op">=</span><span class="fl">2.0</span>, t<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>                                                     connectivity<span class="op">=</span><span class="dv">2</span>, min_area<span class="op">=</span>min_area)</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>colored_label_image <span class="op">=</span> ski.color.label2rgb(labeled_image, bg_label<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>ax.imshow(colored_label_image)</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>ax.set_axis_off()<span class="op">;</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Found"</span>, count, <span class="st">"objects in the image."</span>)</span></code></pre>
</div>
<figure><img src="../fig/shapes-01-filtered-objects.png" alt="Objects filtered by area" class="figure mx-auto d-block"></figure><div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Found 7 objects in the image.</code></pre>
</div>
<p>Note that the small objects are “gone” and we obtain the correct
number of 7 objects in the image.</p>
</div>
</div>
</div>
</div>
<div id="colour-objects-by-area-optional-not-included-in-timing" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="colour-objects-by-area-optional-not-included-in-timing" class="callout-inner">
<h3 class="callout-title">Colour objects by area (optional, not included in timing)</h3>
<div class="callout-content">
<p>Finally, we would like to display the image with the objects coloured
according to the magnitude of their area. In practice, this can be used
with other properties to give visual cues of the object properties.</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Show me the solution </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<p>We already know how to get the areas of the objects from the
<code>regionprops</code>. We just need to insert a zero area value for
the background (to colour it like a zero size object). The background is
also labeled <code>0</code> in the <code>labeled_image</code>, so we
insert the zero area value in front of the first element of
<code>object_areas</code> with <code>np.insert</code>. Then we can
create a <code>colored_area_image</code> where we assign each pixel
value the area by indexing the <code>object_areas</code> with the label
values in <code>labeled_image</code>.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>object_areas <span class="op">=</span> np.array([objf[<span class="st">"area"</span>] <span class="cf">for</span> objf <span class="kw">in</span> ski.measure.regionprops(labeled_image)])</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="co"># prepend zero to object_areas array for background pixels</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>object_areas <span class="op">=</span> np.insert(<span class="dv">0</span>, obj<span class="op">=</span><span class="dv">1</span>, values<span class="op">=</span>object_areas)</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="co"># create image where the pixels in each object are equal to that object's area</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>colored_area_image <span class="op">=</span> object_areas[labeled_image]</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>im <span class="op">=</span> ax.imshow(colored_area_image)</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>cbar <span class="op">=</span> fig.colorbar(im, ax<span class="op">=</span>ax, shrink<span class="op">=</span><span class="fl">0.85</span>)</span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>cbar.ax.set_title(<span class="st">"Area"</span>)</span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>ax.set_axis_off()<span class="op">;</span></span></code></pre>
</div>
<figure><img src="../fig/shapes-01-objects-coloured-by-area.png" alt="Objects colored by area" class="figure mx-auto d-block"></figure><div id="callout5" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>You may have noticed that in the solution, we have used the
<code>labeled_image</code> to index the array <code>object_areas</code>.
This is an example of <a href="https://numpy.org/doc/stable/user/basics.indexing.html#advanced-indexing" class="external-link">advanced
indexing in NumPy</a> The result is an array of the same shape as the
<code>labeled_image</code> whose pixel values are selected from
<code>object_areas</code> according to the object label. Hence the
objects will be colored by area when the result is displayed. Note that
advanced indexing with an integer array works slightly different than
the indexing with a Boolean array that we have used for masking. While
Boolean array indexing returns only the entries corresponding to the
<code>True</code> values of the index, integer array indexing returns an
array with the same shape as the index. You can read more about advanced
indexing in the <a href="https://numpy.org/doc/stable/user/basics.indexing.html#advanced-indexing" class="external-link">NumPy
documentation</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>We can use <code>ski.measure.label</code> to find and label
connected objects in an image.</li>
<li>We can use <code>ski.measure.regionprops</code> to measure
properties of labeled objects.</li>
<li>We can use <code>ski.morphology.remove_small_objects</code> to mask
small objects and remove artifacts from an image.</li>
<li>We can display the labeled image to view the objects coloured by
label.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/07-thresholding.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/09-challenges.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/07-thresholding.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Thresholding
        </a>
        <a class="chapter-link float-end" href="../instructor/09-challenges.html" rel="next">
          Next: Capstone Challenge...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/datacarpentry/image-processing/edit/main/episodes/08-connected-components.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/datacarpentry/image-processing/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/image-processing/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/image-processing/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.10" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://datacarpentry.github.io/image-processing/instructor/08-connected-components.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Connected Component Analysis",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/image-processing/instructor/08-connected-components.html",
  "identifier": "https://datacarpentry.github.io/image-processing/instructor/08-connected-components.html",
  "dateCreated": "2017-03-14",
  "dateModified": "2024-11-13",
  "datePublished": "2024-11-13"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

