<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Image Processing with Python: Thresholding</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/dc/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/dc/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/dc/favicon-16x16.png"><link rel="manifest" href="favicons/dc/site.webmanifest"><link rel="mask-icon" href="favicons/dc/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav data"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dc-logo" alt="Data Carpentry" src="assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/07-thresholding.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Image Processing with Python
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Image Processing with Python
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="edge-detection.html">Extra Episode: Edge Detection</a></li><li><a class="dropdown-item" href="prereqs.html">Prerequisites</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Image Processing with Python
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 57%" class="percentage">
    57%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 57%" aria-valuenow="57" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/07-thresholding.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-image-basics.html">2. Image Basics</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-skimage-images.html">3. Working with scikit-image</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-drawing.html">4. Drawing and Bitwise Operations</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-creating-histograms.html">5. Creating Histograms</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-blurring.html">6. Blurring Images</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        7. Thresholding
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#first-import-the-packages-needed-for-this-episode">First, import the packages needed for this episode</a></li>
<li><a href="#simple-thresholding">Simple thresholding</a></li>
<li><a href="#automatic-thresholding">Automatic thresholding</a></li>
<li><a href="#application-measuring-root-mass">Application: measuring root mass</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-connected-components.html">8. Connected Component Analysis</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-challenges.html">9. Capstone Challenge</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="discuss.html">Discussion</a></li><li><a href="edge-detection.html">Extra Episode: Edge Detection</a></li><li><a href="prereqs.html">Prerequisites</a></li><li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="06-blurring.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="08-connected-components.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="06-blurring.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Blurring Images
        </a>
        <a class="chapter-link float-end" href="08-connected-components.html" rel="next">
          Next: Connected Component...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Thresholding</h1>
        <p>Last updated on 2024-03-12 |

        <a href="https://github.com/datacarpentry/image-processing/edit/main/episodes/07-thresholding.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can we use thresholding to produce a binary image?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Explain what thresholding is and how it can be used.</li>
<li>Use histograms to determine appropriate threshold values to use for
the thresholding process.</li>
<li>Apply simple, fixed-level binary thresholding to an image.</li>
<li>Explain the difference between using the operator <code>&gt;</code>
or the operator <code>&lt;</code> to threshold an image represented by a
NumPy array.</li>
<li>Describe the shape of a binary image produced by thresholding via
<code>&gt;</code> or <code>&lt;</code>.</li>
<li>Explain when Otsu’s method for automatic thresholding is
appropriate.</li>
<li>Apply automatic thresholding to an image using Otsu’s method.</li>
<li>Use the <code>np.count_nonzero()</code> function to count the number
of non-zero pixels in an image.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>In this episode, we will learn how to use scikit-image functions to
apply thresholding to an image. Thresholding is a type of <em>image
segmentation</em>, where we change the pixels of an image to make the
image easier to analyze. In thresholding, we convert an image from
colour or grayscale into a <em>binary image</em>, i.e., one that is
simply black and white. Most frequently, we use thresholding as a way to
select areas of interest of an image, while ignoring the parts we are
not concerned with. We have already done some simple thresholding, in
the “Manipulating pixels” section of <a href="03-skimage-images.html">the <em>Working with scikit-image</em>
episode</a>. In that case, we used a simple NumPy array manipulation to
separate the pixels belonging to the root system of a plant from the
black background. In this episode, we will learn how to use scikit-image
functions to perform thresholding. Then, we will use the masks returned
by these functions to select the parts of an image we are interested
in.</p>
<section><h2 class="section-heading" id="first-import-the-packages-needed-for-this-episode">First, import the packages needed for this episode<a class="anchor" aria-label="anchor" href="#first-import-the-packages-needed-for-this-episode"></a></h2>
<hr class="half-width"><div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="im">import</span> imageio.v3 <span class="im">as</span> iio</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="im">import</span> ipympl</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="im">import</span> skimage <span class="im">as</span> ski</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="op">%</span>matplotlib widget</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="simple-thresholding">Simple thresholding<a class="anchor" aria-label="anchor" href="#simple-thresholding"></a></h2>
<hr class="half-width"><p>Consider the image <code>data/shapes-01.jpg</code> with a series of
crudely cut shapes set against a white background.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># load the image</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>shapes01 <span class="op">=</span> iio.imread(uri<span class="op">=</span><span class="st">"data/shapes-01.jpg"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>ax.imshow(shapes01)</span></code></pre>
</div>
<figure><img src="data/shapes-01.jpg" class="image-with-shadow figure mx-auto d-block" alt="Image with geometric shapes on white background"></figure><p>Now suppose we want to select only the shapes from the image. In
other words, we want to leave the pixels belonging to the shapes “on,”
while turning the rest of the pixels “off,” by setting their colour
channel values to zeros. The scikit-image library has several different
methods of thresholding. We will start with the simplest version, which
involves an important step of human input. Specifically, in this simple,
<em>fixed-level thresholding</em>, we have to provide a threshold value
<code>t</code>.</p>
<p>The process works like this. First, we will load the original image,
convert it to grayscale, and de-noise it as in <a href="06-blurring.html">the <em>Blurring Images</em> episode</a>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># convert the image to grayscale</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>gray_shapes <span class="op">=</span> ski.color.rgb2gray(shapes01)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># blur the image to denoise</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>blurred_shapes <span class="op">=</span> ski.filters.gaussian(gray_shapes, sigma<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>ax.imshow(blurred_shapes, cmap<span class="op">=</span><span class="st">"gray"</span>)</span></code></pre>
</div>
<figure><img src="fig/shapes-01-grayscale.png" class="image-with-shadow figure mx-auto d-block" alt="Grayscale image of the geometric shapes"></figure><p>Next, we would like to apply the threshold <code>t</code> such that
pixels with grayscale values on one side of <code>t</code> will be
turned “on”, while pixels with grayscale values on the other side will
be turned “off”. How might we do that? Remember that grayscale images
contain pixel values in the range from 0 to 1, so we are looking for a
threshold <code>t</code> in the closed range [0.0, 1.0]. We see in the
image that the geometric shapes are “darker” than the white background
but there is also some light gray noise on the background. One way to
determine a “good” value for <code>t</code> is to look at the grayscale
histogram of the image and try to identify what grayscale ranges
correspond to the shapes in the image or the background.</p>
<p>The histogram for the shapes image shown above can be produced as in
<a href="05-creating-histograms.html">the <em>Creating Histograms</em>
episode</a>.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># create a histogram of the blurred grayscale image</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>histogram, bin_edges <span class="op">=</span> np.histogram(blurred_shapes, bins<span class="op">=</span><span class="dv">256</span>, <span class="bu">range</span><span class="op">=</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>))</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>ax.plot(bin_edges[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>], histogram)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>ax.set_title(<span class="st">"Grayscale Histogram"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>ax.set_xlabel(<span class="st">"grayscale value"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>ax.set_ylabel(<span class="st">"pixels"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="fl">1.0</span>)</span></code></pre>
</div>
<figure><img src="fig/shapes-01-histogram.png" alt="Grayscale histogram of the geometric shapes image" class="figure mx-auto d-block"></figure><p>Since the image has a white background, most of the pixels in the
image are white. This corresponds nicely to what we see in the
histogram: there is a peak near the value of 1.0. If we want to select
the shapes and not the background, we want to turn off the white
background pixels, while leaving the pixels for the shapes turned on.
So, we should choose a value of <code>t</code> somewhere before the
large peak and turn pixels above that value “off”. Let us choose
<code>t=0.8</code>.</p>
<p>To apply the threshold <code>t</code>, we can use the NumPy
comparison operators to create a mask. Here, we want to turn “on” all
pixels which have values smaller than the threshold, so we use the less
operator <code>&lt;</code> to compare the <code>blurred_image</code> to
the threshold <code>t</code>. The operator returns a mask, that we
capture in the variable <code>binary_mask</code>. It has only one
channel, and each of its values is either 0 or 1. The binary mask
created by the thresholding operation can be shown with
<code>ax.imshow</code>, where the <code>False</code> entries are shown
as black pixels (0-valued) and the <code>True</code> entries are shown
as white pixels (1-valued).</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># create a mask based on the threshold</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>t <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>binary_mask <span class="op">=</span> blurred_shapes <span class="op">&lt;</span> t</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>ax.imshow(binary_mask, cmap<span class="op">=</span><span class="st">"gray"</span>)</span></code></pre>
</div>
<figure><img src="fig/shapes-01-mask.png" alt="Binary mask of the geometric shapes created by thresholding" class="figure mx-auto d-block"></figure><p>You can see that the areas where the shapes were in the original area
are now white, while the rest of the mask image is black.</p>
<div id="what-makes-a-good-threshold" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="what-makes-a-good-threshold" class="callout-inner">
<h3 class="callout-title">What makes a good threshold?</h3>
<div class="callout-content">
<p>As is often the case, the answer to this question is “it depends”. In
the example above, we could have just switched off all the white
background pixels by choosing <code>t=1.0</code>, but this would leave
us with some background noise in the mask image. On the other hand, if
we choose too low a value for the threshold, we could lose some of the
shapes that are too bright. You can experiment with the threshold by
re-running the above code lines with different values for
<code>t</code>. In practice, it is a matter of domain knowledge and
experience to interpret the peaks in the histogram so to determine an
appropriate threshold. The process often involves trial and error, which
is a drawback of the simple thresholding method. Below we will introduce
automatic thresholding, which uses a quantitative, mathematical
definition for a good threshold that allows us to determine the value of
<code>t</code> automatically. It is worth noting that the principle for
simple and automatic thresholding can also be used for images with pixel
ranges other than [0.0, 1.0]. For example, we could perform thresholding
on pixel intensity values in the range [0, 255] as we have already seen
in <a href="03-skimage-images.html">the <em>Working with
scikit-image</em> episode</a>.</p>
</div>
</div>
</div>
<p>We can now apply the <code>binary_mask</code> to the original
coloured image as we have learned in <a href="04-drawing.html">the
<em>Drawing and Bitwise Operations</em> episode</a>. What we are left
with is only the coloured shapes from the original.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># use the binary_mask to select the "interesting" part of the image</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>selection <span class="op">=</span> shapes01.copy()</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>selection[<span class="op">~</span>binary_mask] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>ax.imshow(selection)</span></code></pre>
</div>
<figure><img src="fig/shapes-01-selected.png" alt="Selected shapes after applying binary mask" class="figure mx-auto d-block"></figure><div id="more-practice-with-simple-thresholding-15-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="more-practice-with-simple-thresholding-15-min" class="callout-inner">
<h3 class="callout-title">More practice with simple thresholding (15 min)</h3>
<div class="callout-content">
<p>Now, it is your turn to practice. Suppose we want to use simple
thresholding to select only the coloured shapes (in this particular case
we consider grayish to be a colour, too) from the image
<code>data/shapes-02.jpg</code>:</p>
<figure><img src="data/shapes-02.jpg" alt="Another image with geometric shapes on white background" class="figure mx-auto d-block"></figure><p>First, plot the grayscale histogram as in the <a href="05-creating-histograms.html">Creating Histogram</a> episode and
examine the distribution of grayscale values in the image. What do you
think would be a good value for the threshold <code>t</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The histogram for the <code>data/shapes-02.jpg</code> image can be
shown with</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>shapes <span class="op">=</span> iio.imread(uri<span class="op">=</span><span class="st">"data/shapes-02.jpg"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>gray_shapes <span class="op">=</span> ski.color.rgb2gray(shapes)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>histogram, bin_edges <span class="op">=</span> np.histogram(gray_shapes, bins<span class="op">=</span><span class="dv">256</span>, <span class="bu">range</span><span class="op">=</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>))</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>ax.plot(bin_edges[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>], histogram)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>ax.set_title(<span class="st">"Graylevel histogram"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>ax.set_xlabel(<span class="st">"gray value"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>ax.set_ylabel(<span class="st">"pixel count"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="fl">1.0</span>)</span></code></pre>
</div>
<figure><img src="fig/shapes-02-histogram.png" alt="Grayscale histogram of the second geometric shapes image" class="figure mx-auto d-block"></figure><p>We can see a large spike around 0.3, and a smaller spike around 0.7.
The spike near 0.3 represents the darker background, so it seems like a
value close to <code>t=0.5</code> would be a good choice.</p>
</div>
</div>
</div>
</div>
<div id="more-practice-with-simple-thresholding-15-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="more-practice-with-simple-thresholding-15-min" class="callout-inner">
<h3 class="callout-title">More practice with simple thresholding (15
min)<em> (continued)</em>
</h3>
<div class="callout-content">
<p>Next, create a mask to turn the pixels above the threshold
<code>t</code> on and pixels below the threshold <code>t</code> off.
Note that unlike the image with a white background we used above, here
the peak for the background colour is at a lower gray level than the
shapes. Therefore, change the comparison operator less <code>&lt;</code>
to greater <code>&gt;</code> to create the appropriate mask. Then apply
the mask to the image and view the thresholded image. If everything
works as it should, your output should show only the coloured shapes on
a black background.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Here are the commands to create and view the binary mask</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>t <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>binary_mask <span class="op">=</span> gray_shapes <span class="op">&gt;</span> t</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>ax.imshow(binary_mask, cmap<span class="op">=</span><span class="st">"gray"</span>)</span></code></pre>
</div>
<figure><img src="fig/shapes-02-mask.png" alt="Binary mask created by thresholding the second geometric shapes image" class="figure mx-auto d-block"></figure><p>And here are the commands to apply the mask and view the thresholded
image</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>shapes02 <span class="op">=</span> iio.imread(uri<span class="op">=</span><span class="st">"data/shapes-02.jpg"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>selection <span class="op">=</span> shapes02.copy()</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>selection[<span class="op">~</span>binary_mask] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>ax.imshow(selection)</span></code></pre>
</div>
<figure><img src="fig/shapes-02-selected.png" alt="Selected shapes after applying binary mask to the second geometric shapes image" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="automatic-thresholding">Automatic thresholding<a class="anchor" aria-label="anchor" href="#automatic-thresholding"></a></h2>
<hr class="half-width"><p>The downside of the simple thresholding technique is that we have to
make an educated guess about the threshold <code>t</code> by inspecting
the histogram. There are also <em>automatic thresholding</em> methods
that can determine the threshold automatically for us. One such method
is <em><a href="https://en.wikipedia.org/wiki/Otsu%27s_method" class="external-link">Otsu’s
method</a></em>. It is particularly useful for situations where the
grayscale histogram of an image has two peaks that correspond to
background and objects of interest.</p>
<div id="denoising-an-image-before-thresholding" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="denoising-an-image-before-thresholding" class="callout-inner">
<h3 class="callout-title">Denoising an image before thresholding</h3>
<div class="callout-content">
<p>In practice, it is often necessary to denoise the image before
thresholding, which can be done with one of the methods from <a href="06-blurring.html">the <em>Blurring Images</em> episode</a>.</p>
</div>
</div>
</div>
<p>Consider the image <code>data/maize-root-cluster.jpg</code> of a
maize root system which we have seen before in <a href="03-skimage-images.html">the <em>Working with scikit-image</em>
episode</a>.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>maize_roots <span class="op">=</span> iio.imread(uri<span class="op">=</span><span class="st">"data/maize-root-cluster.jpg"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>ax.imshow(maize_roots)</span></code></pre>
</div>
<figure><img src="data/maize-root-cluster.jpg" alt="Image of a maize root" class="figure mx-auto d-block"></figure><p>We use Gaussian blur with a sigma of 1.0 to denoise the root image.
Let us look at the grayscale histogram of the denoised image.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># convert the image to grayscale</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>gray_image <span class="op">=</span> ski.color.rgb2gray(maize_roots)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co"># blur the image to denoise</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>blurred_image <span class="op">=</span> ski.filters.gaussian(gray_image, sigma<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co"># show the histogram of the blurred image</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>histogram, bin_edges <span class="op">=</span> np.histogram(blurred_image, bins<span class="op">=</span><span class="dv">256</span>, <span class="bu">range</span><span class="op">=</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>))</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>ax.plot(bin_edges[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>], histogram)</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>ax.set_title(<span class="st">"Graylevel histogram"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>ax.set_xlabel(<span class="st">"gray value"</span>)</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>ax.set_ylabel(<span class="st">"pixel count"</span>)</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="fl">1.0</span>)</span></code></pre>
</div>
<figure><img src="fig/maize-root-cluster-histogram.png" alt="Grayscale histogram of the maize root image" class="figure mx-auto d-block"></figure><p>The histogram has a significant peak around 0.2 and then a broader
“hill” around 0.6 followed by a smaller peak near 1.0. Looking at the
grayscale image, we can identify the peak at 0.2 with the background and
the broader peak with the foreground. Thus, this image is a good
candidate for thresholding with Otsu’s method. The mathematical details
of how this works are complicated (see <a href="https://scikit-image.org/docs/dev/api/skimage.filters.html#threshold-otsu" class="external-link">the
scikit-image documentation</a> if you are interested), but the outcome
is that Otsu’s method finds a threshold value between the two peaks of a
grayscale histogram which might correspond well to the foreground and
background depending on the data and application.</p>

<p>The <code>ski.filters.threshold_otsu()</code> function can be used to
determine the threshold automatically via Otsu’s method. Then NumPy
comparison operators can be used to apply it as before. Here are the
Python commands to determine the threshold <code>t</code> with Otsu’s
method.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># perform automatic thresholding</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>t <span class="op">=</span> ski.filters.threshold_otsu(blurred_image)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Found automatic threshold t = </span><span class="sc">{}</span><span class="st">."</span>.<span class="bu">format</span>(t))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Found automatic threshold t = 0.4172454549881862.</code></pre>
</div>
<p>For this root image and a Gaussian blur with the chosen sigma of 1.0,
the computed threshold value is 0.42. No we can create a binary mask
with the comparison operator <code>&gt;</code>. As we have seen before,
pixels above the threshold value will be turned on, those below the
threshold will be turned off.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># create a binary mask with the threshold found by Otsu's method</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>binary_mask <span class="op">=</span> blurred_image <span class="op">&gt;</span> t</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>ax.imshow(binary_mask, cmap<span class="op">=</span><span class="st">"gray"</span>)</span></code></pre>
</div>
<figure><img src="fig/maize-root-cluster-mask.png" alt="Binary mask of the maize root system" class="figure mx-auto d-block"></figure><p>Finally, we use the mask to select the foreground:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># apply the binary mask to select the foreground</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>selection <span class="op">=</span> maize_roots.copy()</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>selection[<span class="op">~</span>binary_mask] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>ax.imshow(selection)</span></code></pre>
</div>
<figure><img src="fig/maize-root-cluster-selected.png" alt="Masked selection of the maize root system" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="application-measuring-root-mass">Application: measuring root mass<a class="anchor" aria-label="anchor" href="#application-measuring-root-mass"></a></h2>
<hr class="half-width"><p>Let us now turn to an application where we can apply thresholding and
other techniques we have learned to this point. Consider these four
maize root system images, which you can find in the files
<code>data/trial-016.jpg</code>, <code>data/trial-020.jpg</code>,
<code>data/trial-216.jpg</code>, and
<code>data/trial-293.jpg</code>.</p>
<figure><img src="fig/four-maize-roots.jpg" alt="Four images of maize roots" class="figure mx-auto d-block"></figure><p>Suppose we are interested in the amount of plant material in each
image, and in particular how that amount changes from image to image.
Perhaps the images represent the growth of the plant over time, or
perhaps the images show four different maize varieties at the same phase
of their growth. The question we would like to answer is, “how much root
mass is in each image?”</p>
<p>We will first construct a Python program to measure this value for a
single image. Our strategy will be this:</p>
<ol style="list-style-type: decimal"><li>Read the image, converting it to grayscale as it is read. For this
application we do not need the colour image.</li>
<li>Blur the image.</li>
<li>Use Otsu’s method of thresholding to create a binary image, where
the pixels that were part of the maize plant are white, and everything
else is black.</li>
<li>Save the binary image so it can be examined later.</li>
<li>Count the white pixels in the binary image, and divide by the number
of pixels in the image. This ratio will be a measure of the root mass of
the plant in the image.</li>
<li>Output the name of the image processed and the root mass ratio.</li>
</ol><p>Our intent is to perform these steps and produce the numeric result -
a measure of the root mass in the image - without human intervention.
Implementing the steps within a Python function will enable us to call
this function for different images.</p>
<p>Here is a Python function that implements this root-mass-measuring
strategy. Since the function is intended to produce numeric output
without human interaction, it does not display any of the images. Almost
all of the commands should be familiar, and in fact, it may seem simpler
than the code we have worked on thus far, because we are not displaying
any of the images.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="kw">def</span> measure_root_mass(filename, sigma<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>    <span class="co"># read the original image, converting to grayscale on the fly</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    image <span class="op">=</span> iio.imread(uri<span class="op">=</span>filename, mode<span class="op">=</span><span class="st">"L"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    <span class="co"># blur before thresholding</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>    blurred_image <span class="op">=</span> ski.filters.gaussian(image, sigma<span class="op">=</span>sigma)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>    <span class="co"># perform automatic thresholding to produce a binary image</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>    t <span class="op">=</span> ski.filters.threshold_otsu(blurred_image)</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>    binary_mask <span class="op">=</span> blurred_image <span class="op">&gt;</span> t</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>    <span class="co"># determine root mass ratio</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>    root_pixels <span class="op">=</span> np.count_nonzero(binary_mask)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>    w <span class="op">=</span> binary_mask.shape[<span class="dv">1</span>]</span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>    h <span class="op">=</span> binary_mask.shape[<span class="dv">0</span>]</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>    density <span class="op">=</span> root_pixels <span class="op">/</span> (w <span class="op">*</span> h)</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>    <span class="cf">return</span> density</span></code></pre>
</div>
<p>The function begins with reading the original image from the file
<code>filename</code>. We use <code>iio.imread()</code> with the
optional argument <code>mode="L"</code> to automatically convert it to
grayscale. Next, the grayscale image is blurred with a Gaussian filter
with the value of <code>sigma</code> that is passed to the function.
Then we determine the threshold <code>t</code> with Otsu’s method and
create a binary mask just as we did in the previous section. Up to this
point, everything should be familiar.</p>
<p>The final part of the function determines the root mass ratio in the
image. Recall that in the <code>binary_mask</code>, every pixel has
either a value of zero (black/background) or one (white/foreground). We
want to count the number of white pixels, which can be accomplished with
a call to the NumPy function <code>np.count_nonzero</code>. Then we
determine the width and height of the image by using the elements of
<code>binary_mask.shape</code> (that is, the dimensions of the NumPy
array that stores the image). Finally, the density ratio is calculated
by dividing the number of white pixels by the total number of pixels
<code>w*h</code> in the image. The function returns then root density of
the image.</p>
<p>We can call this function with any filename and provide a sigma value
for the blurring. If no sigma value is provided, the default value 1.0
will be used. For example, for the file <code>data/trial-016.jpg</code>
and a sigma value of 1.5, we would call the function like this:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>measure_root_mass(filename<span class="op">=</span><span class="st">"data/trial-016.jpg"</span>, sigma<span class="op">=</span><span class="fl">1.5</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0.0482436835106383`</code></pre>
</div>
<p>Now we can use the function to process the series of four images
shown above. In a real-world scientific situation, there might be
dozens, hundreds, or even thousands of images to process. To save us the
tedium of calling the function for each image by hand, we can write a
loop that processes all files automatically. The following code block
assumes that the files are located in the same directory and the
filenames all start with the <strong>trial-</strong> prefix and end with
the <strong>.jpg</strong> suffix.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>all_files <span class="op">=</span> glob.glob(<span class="st">"data/trial-*.jpg"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> all_files:</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    density <span class="op">=</span> measure_root_mass(filename<span class="op">=</span>filename, sigma<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    <span class="co"># output in format suitable for .csv</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>    <span class="bu">print</span>(filename, density, sep<span class="op">=</span><span class="st">","</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>data/trial-016.jpg,0.0482436835106383
data/trial-020.jpg,0.06346941489361702
data/trial-216.jpg,0.14073969414893617
data/trial-293.jpg,0.13607895611702128</code></pre>
</div>
<div id="ignoring-more-of-the-images-brainstorming-10-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="ignoring-more-of-the-images-brainstorming-10-min" class="callout-inner">
<h3 class="callout-title">Ignoring more of the images – brainstorming (10 min)</h3>
<div class="callout-content">
<p>Let us take a closer look at the binary masks produced by the
<code>measure_root_mass</code> function.</p>
<figure><img src="fig/four-maize-roots-binary.jpg" alt="Binary masks of the four maize root images" class="figure mx-auto d-block"></figure><p>You may have noticed in the section on automatic thresholding that
the thresholded image does include regions of the image aside of the
plant root: the numbered labels and the white circles in each image are
preserved during the thresholding, because their grayscale values are
above the threshold. Therefore, our calculated root mass ratios include
the white pixels of the label and white circle that are not part of the
plant root. Those extra pixels affect how accurate the root mass
calculation is!</p>
<p>How might we remove the labels and circles before calculating the
ratio, so that our results are more accurate? Think about some options
given what we have learned so far.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>One approach we might take is to try to completely mask out a region
from each image, particularly, the area containing the white circle and
the numbered label. If we had coordinates for a rectangular area on the
image that contained the circle and the label, we could mask the area
out by using techniques we learned in <a href="04-drawing.html">the
<em>Drawing and Bitwise Operations</em> episode</a>.</p>
<p>However, a closer inspection of the binary images raises some issues
with that approach. Since the roots are not always constrained to a
certain area in the image, and since the circles and labels are in
different locations each time, we would have difficulties coming up with
a single rectangle that would work for <em>every</em> image. We could
create a different masking rectangle for each image, but that is not a
practicable approach if we have hundreds or thousands of images to
process.</p>
<p>Another approach we could take is to apply two thresholding steps to
the image. Look at the graylevel histogram of the file
<code>data/trial-016.jpg</code> shown above again: Notice the peak near
1.0? Recall that a grayscale value of 1.0 corresponds to white pixels:
the peak corresponds to the white label and circle. So, we could use
simple binary thresholding to mask the white circle and label from the
image, and then we could use Otsu’s method to select the pixels in the
plant portion of the image.</p>
<p>Note that most of this extra work in processing the image could have
been avoided during the experimental design stage, with some careful
consideration of how the resulting images would be used. For example,
all of the following measures could have made the images easier to
process, by helping us predict and/or detect where the label is in the
image and subsequently mask it from further processing:</p>
<ul><li>Using labels with a consistent size and shape</li>
<li>Placing all the labels in the same position, relative to the
sample</li>
<li>Using a non-white label, with non-black writing</li>
</ul></div>
</div>
</div>
</div>
<div id="ignoring-more-of-the-images-implementation-30-min---optional-not-included-in-timing" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="ignoring-more-of-the-images-implementation-30-min---optional-not-included-in-timing" class="callout-inner">
<h3 class="callout-title">Ignoring more of the images – implementation (30 min - optional, not included in timing)</h3>
<div class="callout-content">
<p>Implement an enhanced version of the function
<code>measure_root_mass</code> that applies simple binary thresholding
to remove the white circle and label from the image before applying
Otsu’s method.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>We can apply a simple binary thresholding with a threshold
<code>t=0.95</code> to remove the label and circle from the image. We
can then use the binary mask to calculate the Otsu threshold without the
pixels from the label and circle.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="kw">def</span> enhanced_root_mass(filename, sigma):</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>    <span class="co"># read the original image, converting to grayscale on the fly</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>    image <span class="op">=</span> iio.imread(uri<span class="op">=</span>filename, mode<span class="op">=</span><span class="st">"L"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>    <span class="co"># blur before thresholding</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    blurred_image <span class="op">=</span> ski.filters.gaussian(image, sigma<span class="op">=</span>sigma)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>    <span class="co"># perform binary thresholding to mask the white label and circle</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>    binary_mask <span class="op">=</span> blurred_image <span class="op">&lt;</span> <span class="fl">0.95</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>    </span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>    <span class="co"># perform automatic thresholding using only the pixels with value True in the binary mask</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>    t <span class="op">=</span> ski.filters.threshold_otsu(blurred_image[binary_mask])</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>    </span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>    <span class="co"># update binary mask to identify pixels which are both less than 0.95 and greater than t</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>    binary_mask <span class="op">=</span> (blurred_image <span class="op">&lt;</span> <span class="fl">0.95</span>) <span class="op">&amp;</span> (blurred_image <span class="op">&gt;</span> t)</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>    <span class="co"># determine root mass ratio</span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>    root_pixels <span class="op">=</span> np.count_nonzero(binary_mask)</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>    w <span class="op">=</span> binary_mask.shape[<span class="dv">1</span>]</span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>    h <span class="op">=</span> binary_mask.shape[<span class="dv">0</span>]</span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a>    density <span class="op">=</span> root_pixels <span class="op">/</span> (w <span class="op">*</span> h)</span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a>    <span class="cf">return</span> density</span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a>all_files <span class="op">=</span> glob.glob(<span class="st">"data/trial-*.jpg"</span>)</span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> all_files:</span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a>    density <span class="op">=</span> enhanced_root_mass(filename<span class="op">=</span>filename, sigma<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a>    <span class="co"># output in format suitable for .csv</span></span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a>    <span class="bu">print</span>(filename, density, sep<span class="op">=</span><span class="st">","</span>)</span></code></pre>
</div>
<p>The output of the improved program does illustrate that the white
circles and labels were skewing our root mass ratios:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>data/trial-016.jpg,0.046250166223404256
data/trial-020.jpg,0.05886968085106383
data/trial-216.jpg,0.13712117686170214
data/trial-293.jpg,0.13190342420212767</code></pre>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> What is &amp; doing in the example above? </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>The <code>&amp;</code> operator above means that we have defined a
logical AND statement. This combines the two tests of pixel intensities
in the blurred image such that both must be true for a pixel’s position
to be set to <code>True</code> in the resulting mask.</p>
<table class="table"><colgroup><col width="35%"><col width="32%"><col width="32%"></colgroup><thead><tr class="header"><th>Result of <code>t &lt; blurred_image</code>
</th>
<th>Result of <code>blurred_image &lt; 0.95</code>
</th>
<th>Resulting value in <code>binary_mask</code>
</th>
</tr></thead><tbody><tr class="odd"><td>False</td>
<td>True</td>
<td>False</td>
</tr><tr class="even"><td>True</td>
<td>False</td>
<td>False</td>
</tr><tr class="odd"><td>True</td>
<td>True</td>
<td>True</td>
</tr></tbody></table><p>Knowing how to construct this kind of logical operation can be very
helpful in image processing. The University of Minnesota Library’s <a href="https://libguides.umn.edu/BooleanOperators" class="external-link">guide to Boolean
operators</a> is a good place to start if you want to learn more.</p>
</div>
</div>
</div>
</div>
<p>Here are the binary images produced by the additional thresholding.
Note that we have not completely removed the offending white pixels.
Outlines still remain. However, we have reduced the number of extraneous
pixels, which should make the output more accurate.</p>
<figure><img src="fig/four-maize-roots-binary-improved.jpg" alt="Improved binary masks of the four maize root images" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
<div id="thresholding-a-bacteria-colony-image-15-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="thresholding-a-bacteria-colony-image-15-min" class="callout-inner">
<h3 class="callout-title">Thresholding a bacteria colony image (15 min)</h3>
<div class="callout-content">
<p>In the images directory <code>data/</code>, you will find an image
named <code>colonies-01.tif</code>.</p>
<figure><img src="fig/colonies-01.jpg" alt="Image of bacteria colonies in a petri dish" class="figure mx-auto d-block"></figure><p>This is one of the images you will be working with in the
morphometric challenge at the end of the workshop.</p>
<ol style="list-style-type: decimal"><li>Plot and inspect the grayscale histogram of the image to determine a
good threshold value for the image.</li>
<li>Create a binary mask that leaves the pixels in the bacteria colonies
“on” while turning the rest of the pixels in the image “off”.</li>
</ol></div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>Here is the code to create the grayscale histogram:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>bacteria <span class="op">=</span> iio.imread(uri<span class="op">=</span><span class="st">"data/colonies-01.tif"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>gray_image <span class="op">=</span> ski.color.rgb2gray(bacteria)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>blurred_image <span class="op">=</span> ski.filters.gaussian(gray_image, sigma<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>histogram, bin_edges <span class="op">=</span> np.histogram(blurred_image, bins<span class="op">=</span><span class="dv">256</span>, <span class="bu">range</span><span class="op">=</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>))</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>ax.plot(bin_edges[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>], histogram)</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>ax.set_title(<span class="st">"Graylevel histogram"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>ax.set_xlabel(<span class="st">"gray value"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>ax.set_ylabel(<span class="st">"pixel count"</span>)</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="fl">1.0</span>)</span></code></pre>
</div>
<figure><img src="fig/colonies-01-histogram.png" alt="Grayscale histogram of the bacteria colonies image" class="figure mx-auto d-block"></figure><p>The peak near one corresponds to the white image background, and the
broader peak around 0.5 corresponds to the yellow/brown culture medium
in the dish. The small peak near zero is what we are after: the dark
bacteria colonies. A reasonable choice thus might be to leave pixels
below <code>t=0.2</code> on.</p>
<p>Here is the code to create and show the binarized image using the
<code>&lt;</code> operator with a threshold <code>t=0.2</code>:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>t <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>binary_mask <span class="op">=</span> blurred_image <span class="op">&lt;</span> t</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>ax.imshow(binary_mask, cmap<span class="op">=</span><span class="st">"gray"</span>)</span></code></pre>
</div>
<figure><img src="fig/colonies-01-mask.png" alt="Binary mask of the bacteria colonies image" class="figure mx-auto d-block"></figure><p>When you experiment with the threshold a bit, you can see that in
particular the size of the bacteria colony near the edge of the dish in
the top right is affected by the choice of the threshold.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Thresholding produces a binary image, where all pixels with
intensities above (or below) a threshold value are turned on, while all
other pixels are turned off.</li>
<li>The binary images produced by thresholding are held in
two-dimensional NumPy arrays, since they have only one colour value
channel. They are boolean, hence they contain the values 0 (off) and 1
(on).</li>
<li>Thresholding can be used to create masks that select only the
interesting parts of an image, or as the first step before edge
detection or finding contours.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="06-blurring.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="08-connected-components.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="06-blurring.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Blurring Images
        </a>
        <a class="chapter-link float-end" href="08-connected-components.html" rel="next">
          Next: Connected Component...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/datacarpentry/image-processing/edit/main/episodes/07-thresholding.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/datacarpentry/image-processing/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/image-processing/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/image-processing/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.10" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://datacarpentry.github.io/image-processing/07-thresholding.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Thresholding",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/image-processing/07-thresholding.html",
  "identifier": "https://datacarpentry.github.io/image-processing/07-thresholding.html",
  "dateCreated": "2017-03-14",
  "dateModified": "2024-03-12",
  "datePublished": "2024-11-12"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

